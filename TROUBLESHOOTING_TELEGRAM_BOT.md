# Диагностика проблем с Telegram ботом

## Как проверить, почему бот не работает

### 1. Проверка переменных окружения

Убедитесь, что `TELEGRAM_BOT_TOKEN` установлен:

```bash
# В Docker контейнере
docker-compose exec backend env | grep TELEGRAM_BOT_TOKEN
```

Или проверьте файл `.env`:
```bash
cat .env | grep TELEGRAM_BOT_TOKEN
```

### 2. Проверка логов бота

Посмотрите логи backend контейнера:

```bash
# Все логи
docker-compose logs backend

# Только логи Telegram бота
docker-compose logs backend | grep -i telegram

# Последние 50 строк
docker-compose logs --tail=50 backend
```

### 3. Признаки проблем

#### Бот не запускается:
- В логах: `⚠️ TELEGRAM_BOT_TOKEN не установлен, бот не будет запущен`
- **Решение**: Добавьте `TELEGRAM_BOT_TOKEN=ваш_токен` в `.env` и перезапустите:
  ```bash
  docker-compose restart backend
  ```

#### Ошибки polling:
- В логах: `❌ Ошибка polling Telegram бота: ...`
- Возможные причины:
  - Неверный токен бота
  - Проблемы с интернет-соединением
  - Бот удален в BotFather
- **Решение**: Проверьте токен в BotFather, пересоздайте токен при необходимости

#### Ошибки подключения:
- В логах: `❌ Ошибка Telegram бота: ...`
- Возможные причины:
  - Блокировка Telegram API (проблемы в стране/регионе)
  - Проблемы с сетью Docker
- **Решение**: Проверьте подключение к интернету, настройки прокси (если используются)

### 4. Проверка работы бота

1. Откройте Telegram и найдите вашего бота
2. Отправьте команду `/start`
3. Если бот не отвечает, проверьте логи:
   ```bash
   docker-compose logs -f backend
   ```

### 5. Перезапуск бота

После изменения переменных окружения:

```bash
# Перезапуск только backend
docker-compose restart backend

# Или пересборка (если изменили код)
docker-compose up -d --build backend
```

### 6. Проверка токена

Убедитесь, что токен правильный:
1. Откройте [@BotFather](https://t.me/BotFather) в Telegram
2. Отправьте `/mybots`
3. Выберите вашего бота
4. Проверьте токен в разделе "API Token"

### 7. Тестирование токена

Можно проверить токен через API:

```bash
curl https://api.telegram.org/botВАШ_ТОКЕН/getMe
```

Если токен верный, получите информацию о боте. Если неверный - ошибку.

### 8. Частые проблемы

#### Бот работал, но перестал:
1. Проверьте, не был ли токен изменен в BotFather
2. Проверьте логи на наличие ошибок
3. Проверьте, запущен ли контейнер: `docker-compose ps`

#### Бот никогда не работал:
1. Проверьте наличие `TELEGRAM_BOT_TOKEN` в `.env`
2. Проверьте правильность токена
3. Проверьте логи при запуске: `docker-compose logs backend | head -20`

#### Бот отвечает с задержкой или нестабильно:
1. Проверьте нагрузку на сервер
2. Проверьте качество интернет-соединения
3. Проверьте логи на частые ошибки

### 9. Полезные команды

```bash
# Проверить статус контейнеров
docker-compose ps

# Перезапустить все сервисы
docker-compose restart

# Пересобрать и перезапустить
docker-compose up -d --build

# Посмотреть последние логи с обновлением в реальном времени
docker-compose logs -f backend

# Войти в контейнер для отладки
docker-compose exec backend sh
```

### 10. Получение нового токена

Если токен скомпрометирован или утерян:

1. Откройте [@BotFather](https://t.me/BotFather)
2. Отправьте `/mybots`
3. Выберите вашего бота
4. Выберите "API Token"
5. Выберите "Revoke current token" (отозвать текущий)
6. Скопируйте новый токен
7. Обновите `.env` файл
8. Перезапустите backend: `docker-compose restart backend`







