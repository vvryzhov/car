import { useAuth } from '../contexts/AuthContext';
import { useNavigate } from 'react-router-dom';
import Footer from '../components/Footer';
import './Help.css';

const Help = () => {
  const { user, logout } = useAuth();
  const navigate = useNavigate();

  const renderUserHelp = () => (
    <div className="help-content">
      <h2>Помощь для пользователя</h2>
      
      <section>
        <h3>Основные возможности</h3>
        <ul>
          <li><strong>Создание заявок на пропуск:</strong> Вы можете создавать заявки на въезд транспортных средств на территорию.</li>
          <li><strong>Просмотр своих заявок:</strong> Вы видите все свои заявки с их статусами.</li>
          <li><strong>Редактирование заявок:</strong> Вы можете редактировать свои заявки до их активации охраной (статус "Заехал").</li>
          <li><strong>Удаление заявок:</strong> Вы можете удалять свои заявки, кроме тех, у которых статус "Заехал".</li>
          <li><strong>Просмотр участков:</strong> Вы можете просматривать свои участки в профиле.</li>
          <li><strong>Редактирование профиля:</strong> Вы можете изменить свой контактный телефон и пароль.</li>
        </ul>
      </section>

      <section>
        <h3>Создание заявки</h3>
        <ul>
          <li><strong>Тип транспорта:</strong> Выберите "Легковой" или "Грузовой".</li>
          <li><strong>Марка авто:</strong> Начните вводить марку - система предложит варианты. Можно ввести марку на русском языке (например, "Тесла", "Мерседес", "БМВ") - система автоматически преобразует её в правильное название (например, "Tesla", "Mercedes-Benz", "BMW"). Можно ввести свою марку, если её нет в списке.</li>
          <li><strong>Номер авто:</strong> Введите номер автомобиля. Поддерживаются форматы: РФ (А123БВ777), Казахстан (123АВС01), Узбекистан (01А123ВС) и другие.</li>
          <li><strong>Дата въезда:</strong> Выберите дату планируемого въезда.</li>
          <li><strong>Участок:</strong> Выберите участок из списка ваших участков.</li>
          <li><strong>Комментарий:</strong> При необходимости добавьте дополнительную информацию.</li>
        </ul>
      </section>

      <section>
        <h3>Правила работы с заявками</h3>
        <ul>
          <li>Заявка должна быть создана заранее, до планируемого въезда.</li>
          <li>Укажите корректные данные: тип транспорта, марку, номер, дату въезда, участок.</li>
          <li>После создания заявка имеет статус "Ожидает".</li>
          <li>Охрана проверяет заявку и может изменить её статус на "Заехал" или "Отклонен".</li>
          <li><strong>Важно:</strong> После того, как охрана установит статус "Заехал", вы не сможете редактировать или удалять эту заявку.</li>
          <li>Заявки со статусом "Ожидает" или "Отклонен" можно редактировать и удалять.</li>
        </ul>
      </section>

      <section>
        <h3>Управление участками</h3>
        <ul>
          <li>Вы можете просматривать свои участки в профиле.</li>
          <li>Для добавления, изменения или удаления участков обратитесь к администратору.</li>
          <li>Участки необходимы для создания заявок на пропуск.</li>
        </ul>
      </section>

      <section>
        <h3>Статусы заявок</h3>
        <ul>
          <li><strong>Ожидает:</strong> Заявка создана и ожидает проверки охраной. Можно редактировать и удалять.</li>
          <li><strong>Заехал:</strong> Транспорт заехал на территорию (активировано охраной). Редактирование и удаление недоступны.</li>
          <li><strong>Отклонен:</strong> Заявка отклонена охраной. Можно редактировать и удалять.</li>
        </ul>
      </section>

      <section>
        <h3>Telegram бот</h3>
        <ul>
          <li>Вы можете создавать заявки на пропуск через Telegram бота: <strong>@anosinopark_bot</strong>.</li>
          <li>Для использования бота необходимо привязать ваш Telegram аккаунт в профиле.</li>
          <li>После привязки вы сможете создавать и просматривать заявки прямо в Telegram.</li>
          <li>Используйте команды бота: /start, /create, /list, /help.</li>
        </ul>
      </section>

      <section>
        <h3>Безопасность</h3>
        <ul>
          <li>Пароль должен содержать минимум 6 символов, включая буквы и цифры.</li>
          <li>Не передавайте свои учетные данные третьим лицам.</li>
          <li>При утере пароля используйте функцию восстановления пароля.</li>
          <li>При смене email на новый адрес будет отправлен код подтверждения для безопасности.</li>
        </ul>
      </section>
    </div>
  );

  const renderForemanHelp = () => (
    <div className="help-content">
      <h2>Помощь для прораба</h2>
      
      <section>
        <h3>Основные возможности</h3>
        <ul>
          <li><strong>Создание заявок на пропуск:</strong> Вы можете создавать заявки на въезд транспортных средств.</li>
          <li><strong>Просмотр своих заявок:</strong> Вы видите все свои заявки с их статусами.</li>
          <li><strong>Редактирование заявок:</strong> Вы можете редактировать свои заявки до их активации охраной (статус "Заехал").</li>
          <li><strong>Удаление заявок:</strong> Вы можете удалять свои заявки, кроме тех, у которых статус "Заехал".</li>
          <li><strong>Просмотр участков:</strong> Вы можете просматривать свои участки в профиле.</li>
          <li><strong>Редактирование профиля:</strong> Вы можете изменить свой контактный телефон и пароль.</li>
          <li><strong>Привязка Telegram:</strong> Вы можете привязать свой Telegram аккаунт для создания заявок через бота.</li>
          <li><strong>Смена email:</strong> Вы можете изменить свой email адрес с подтверждением через код, отправленный на новый адрес.</li>
        </ul>
      </section>

      <section>
        <h3>Особенности роли прораба</h3>
        <ul>
          <li>Ваш аккаунт может иметь установленную дату деактивации.</li>
          <li>После наступления даты деактивации вы не сможете войти в систему.</li>
          <li>О дате деактивации вас уведомит администратор.</li>
          <li>Права на управление заявками такие же, как у обычных пользователей.</li>
        </ul>
      </section>

      <section>
        <h3>Создание заявки</h3>
        <ul>
          <li><strong>Тип транспорта:</strong> Выберите "Легковой" или "Грузовой".</li>
          <li><strong>Марка авто:</strong> Начните вводить марку - система предложит варианты. Можно ввести марку на русском языке (например, "Тесла", "Мерседес", "БМВ") - система автоматически преобразует её в правильное название (например, "Tesla", "Mercedes-Benz", "BMW"). Можно ввести свою марку, если её нет в списке.</li>
          <li><strong>Номер авто:</strong> Введите номер автомобиля. Поддерживаются форматы: РФ (А123БВ777), Казахстан (123АВС01), Узбекистан (01А123ВС) и другие.</li>
          <li><strong>Дата въезда:</strong> Введите дату планируемого въезда в формате дд-мм-гггг (например, 25-12-2024).</li>
          <li><strong>Участок:</strong> Выберите участок из списка ваших участков.</li>
          <li><strong>Комментарий:</strong> При необходимости добавьте дополнительную информацию.</li>
        </ul>
      </section>

      <section>
        <h3>Правила работы с заявками</h3>
        <ul>
          <li>Заявка должна быть создана заранее, до планируемого въезда.</li>
          <li>Укажите корректные данные: тип транспорта, марку, номер, дату въезда в формате дд-мм-гггг, участок.</li>
          <li>После создания заявка имеет статус "Ожидает".</li>
          <li>Охрана проверяет заявку и может изменить её статус на "Заехал" или "Отклонен".</li>
          <li><strong>Важно:</strong> После того, как охрана установит статус "Заехал", вы не сможете редактировать или удалять эту заявку.</li>
          <li>Заявки со статусом "Ожидает" или "Отклонен" можно редактировать и удалять.</li>
        </ul>
      </section>

      <section>
        <h3>Управление участками</h3>
        <ul>
          <li>Вы можете просматривать свои участки в профиле.</li>
          <li>Для добавления, изменения или удаления участков обратитесь к администратору.</li>
          <li>Участки необходимы для создания заявок на пропуск.</li>
        </ul>
      </section>

      <section>
        <h3>Статусы заявок</h3>
        <ul>
          <li><strong>Ожидает:</strong> Заявка создана и ожидает проверки охраной. Можно редактировать и удалять.</li>
          <li><strong>Заехал:</strong> Транспорт заехал на территорию (активировано охраной). Редактирование и удаление недоступны.</li>
          <li><strong>Отклонен:</strong> Заявка отклонена охраной. Можно редактировать и удалять.</li>
        </ul>
      </section>

      <section>
        <h3>Telegram бот</h3>
        <ul>
          <li>Вы можете создавать заявки на пропуск через Telegram бота: <strong>@anosinopark_bot</strong>.</li>
          <li>Для использования бота необходимо привязать ваш Telegram аккаунт в профиле.</li>
          <li>После привязки вы сможете создавать и просматривать заявки прямо в Telegram.</li>
          <li>Используйте команды бота: /start, /create, /list, /help.</li>
        </ul>
      </section>
    </div>
  );

  const renderSecurityHelp = () => (
    <div className="help-content">
      <h2>Помощь для охраны</h2>
      
      <section>
        <h3>Основные возможности</h3>
        <ul>
          <li><strong>Просмотр всех заявок:</strong> Вы видите все заявки на пропуск, созданные пользователями.</li>
          <li><strong>Фильтрация заявок:</strong> Вы можете фильтровать заявки по дате въезда и типу транспорта.</li>
          <li><strong>Активация заявок:</strong> Вы можете изменить статус заявки на "Заехал" когда транспорт заехал на территорию.</li>
          <li><strong>Отклонение заявок:</strong> Вы можете отклонить заявку, если она не соответствует требованиям.</li>
          <li><strong>Редактирование заявок:</strong> Вы можете редактировать данные заявки: тип транспорта, марку авто, номер авто, дату въезда, адрес, ФИО пользователя.</li>
          <li><strong>Добавление комментария охраны:</strong> Вы можете добавить комментарий к заявке для внутреннего использования.</li>
        </ul>
      </section>

      <section>
        <h3>Правила работы с заявками</h3>
        <ul>
          <li>Проверяйте заявки перед активацией.</li>
          <li>Убедитесь, что данные в заявке соответствуют реальному транспорту.</li>
          <li>Активируйте заявку (установите статус "Заехал") только после фактического въезда транспорта.</li>
          <li><strong>Важно:</strong> После установки статуса "Заехал" пользователи и прорабы не смогут редактировать или удалять эту заявку.</li>
          <li>При необходимости вы можете отредактировать данные заявки: тип транспорта, марку, номер, дату, адрес, ФИО.</li>
          <li>Вы не можете редактировать комментарий пользователя и номер участка.</li>
          <li>Вы не можете изменять участок в заявке.</li>
        </ul>
      </section>

      <section>
        <h3>Редактирование заявок</h3>
        <ul>
          <li>Вы можете редактировать любые заявки, независимо от их статуса.</li>
          <li>При редактировании вы можете изменить: тип транспорта, марку авто, номер авто, дату въезда, адрес, ФИО пользователя, статус, комментарий охраны.</li>
          <li>Вы не можете изменять: комментарий пользователя, номер участка.</li>
          <li>Марка авто поддерживает автодополнение - начните вводить, и система предложит варианты. Можно ввести марку на русском языке (например, "Тесла", "Мерседес", "БМВ") - система автоматически преобразует её в правильное название.</li>
          <li>Номер авто проверяется на корректность формата (РФ, Казахстан, Узбекистан и другие форматы).</li>
          <li>Дата въезда вводится в формате дд-мм-гггг (например, 25-12-2024).</li>
        </ul>
      </section>

      <section>
        <h3>Статусы заявок</h3>
        <ul>
          <li><strong>Ожидает:</strong> Заявка создана пользователем и ожидает проверки. Пользователь может редактировать и удалять.</li>
          <li><strong>Заехал:</strong> Транспорт заехал на территорию. Установите этот статус при въезде. После этого пользователь не сможет редактировать или удалять заявку.</li>
          <li><strong>Отклонен:</strong> Заявка отклонена. Пользователь может редактировать и удалять.</li>
        </ul>
      </section>

      <section>
        <h3>Автоматическое обновление</h3>
        <ul>
          <li>Список заявок автоматически обновляется в реальном времени при создании или изменении заявок.</li>
          <li>Обновление приостанавливается, когда открыто окно редактирования заявки.</li>
          <li>Не нужно обновлять страницу вручную - новые заявки появляются автоматически.</li>
        </ul>
      </section>

      <section>
        <h3>Быстрое изменение статуса</h3>
        <ul>
          <li>Вы можете быстро изменить статус заявки прямо в списке, не открывая окно редактирования.</li>
          <li>Нажмите на кнопку статуса "Ожидает → Заехал" или "Заехал → Ожидает" для переключения статуса.</li>
          <li>Это позволяет быстро отмечать заявки при въезде транспорта на территорию.</li>
          <li>Для более детального редактирования используйте кнопку "Редактировать".</li>
        </ul>
      </section>

      <section>
        <h3>Фильтрация заявок</h3>
        <ul>
          <li><strong>По дате въезда:</strong> Выберите конкретную дату для просмотра заявок на эту дату.</li>
          <li><strong>По типу транспорта:</strong> Фильтруйте заявки по типу - "Грузовой" или "Легковой".</li>
          <li><strong>По статусу:</strong> Фильтруйте заявки по статусу - "Ожидает", "Заехал" или "Отклонено".</li>
          <li><strong>По участку:</strong> Введите номер участка для поиска заявок по конкретному участку.</li>
          <li>Используйте кнопку "Сбросить фильтры" для очистки всех фильтров.</li>
        </ul>
      </section>
    </div>
  );

  const renderAdminHelp = () => (
    <div className="help-content">
      <h2>Помощь для администратора</h2>
      
      <section>
        <h3>Управление пользователями</h3>
        <ul>
          <li><strong>Создание пользователей:</strong> Вы можете создавать новых пользователей с ролями: Пользователь, Прораб, Охрана, Администратор.</li>
          <li><strong>Редактирование пользователей:</strong> Вы можете редактировать данные любого пользователя, включая участки и адреса.</li>
          <li><strong>Управление участками:</strong> Вы можете добавлять, редактировать и удалять участки для пользователей и прорабов.</li>
          <li><strong>Смена пароля:</strong> Вы можете изменить пароль любого пользователя.</li>
          <li><strong>Отправка ссылки на сброс пароля:</strong> Вы можете принудительно отправить пользователю ссылку на сброс пароля (одиночно или массово для выбранных пользователей).</li>
          <li><strong>Деактивация аккаунтов:</strong> Вы можете деактивировать любой аккаунт или установить дату деактивации для прорабов.</li>
          <li><strong>Массовое удаление:</strong> Вы можете выбрать несколько пользователей и удалить их одновременно.</li>
          <li><strong>Массовая загрузка:</strong> Вы можете загрузить пользователей из CSV файла. Один пользователь может иметь несколько участков.</li>
          <li><strong>Фильтрация:</strong> Используйте фильтры для поиска пользователей по email, телефону, ФИО, участку, роли.</li>
        </ul>
      </section>

      <section>
        <h3>Управление заявками</h3>
        <ul>
          <li><strong>Просмотр всех заявок:</strong> Вы видите все заявки на пропуск в системе.</li>
          <li><strong>Фильтрация заявок:</strong> Вы можете фильтровать заявки по дате въезда, типу транспорта, пользователю, номеру участка.</li>
          <li><strong>Редактирование заявок:</strong> Вы можете редактировать любые заявки, включая те, у которых статус "Заехал".</li>
          <li><strong>Удаление заявок:</strong> Вы можете удалять любые заявки, включая те, у которых статус "Заехал".</li>
          <li><strong>Экспорт в Excel:</strong> Вы можете экспортировать отфильтрованные заявки в Excel файл для дальнейшей обработки.</li>
        </ul>
      </section>

      <section>
        <h3>Экспорт заявок в Excel</h3>
        <ul>
          <li>Примените нужные фильтры к списку заявок (дата, тип транспорта, пользователь, участок).</li>
          <li>Нажмите кнопку "Экспорт в Excel".</li>
          <li>Файл будет скачан автоматически с именем "заявки_YYYY-MM-DD.xlsx".</li>
          <li>В файле будут все колонки: ФИО, Телефон, Участок, Тип транспорта, Марка авто, Номер авто, Дата въезда, Адрес, Комментарии, Статус, Дата создания.</li>
          <li>Экспортируются только заявки, соответствующие примененным фильтрам.</li>
        </ul>
      </section>

      <section>
        <h3>Роли пользователей и их права</h3>
        <ul>
          <li><strong>Пользователь:</strong> Может создавать и управлять своими заявками. Не может редактировать/удалять заявки со статусом "Заехал". Может только просматривать свои участки.</li>
          <li><strong>Прораб:</strong> Имеет те же права, что и пользователь, но может иметь дату деактивации аккаунта. Не может редактировать/удалять заявки со статусом "Заехал".</li>
          <li><strong>Охрана:</strong> Может просматривать все заявки, активировать их, редактировать данные заявок. Не может видеть и редактировать участки пользователей.</li>
          <li><strong>Администратор:</strong> Полный доступ ко всем функциям системы, включая управление пользователями, участками, заявками, экспорт в Excel.</li>
        </ul>
      </section>

      <section>
        <h3>Управление участками</h3>
        <ul>
          <li>Пользователи и прорабы могут только просматривать свои участки.</li>
          <li>Только администратор может добавлять, редактировать и удалять участки для пользователей и прорабов.</li>
          <li>При создании пользователя с ролью "Пользователь" или "Прораб" необходимо добавить хотя бы один участок.</li>
          <li>Один пользователь может иметь несколько участков.</li>
          <li>При массовой загрузке из CSV один пользователь (по email) может иметь несколько участков.</li>
        </ul>
      </section>

      <section>
        <h3>Настройки системы</h3>
        <ul>
          <li><strong>Настройка почтового сервера:</strong> В разделе "Настройки" вы можете настроить SMTP для отправки писем с восстановлением пароля.</li>
          <li><strong>Тестирование почты:</strong> Вы можете отправить тестовое письмо для проверки настроек SMTP.</li>
        </ul>
      </section>

      <section>
        <h3>Правила работы</h3>
        <ul>
          <li>Регулярно проверяйте список пользователей на наличие деактивированных аккаунтов.</li>
          <li>Устанавливайте дату деактивации для прорабов при необходимости.</li>
          <li>Следите за безопасностью системы: используйте надежные пароли.</li>
          <li>При создании пользователей указывайте корректные данные.</li>
          <li>Помогайте пользователям с управлением участками - только вы можете их редактировать.</li>
          <li>Используйте экспорт в Excel для анализа и отчетности по заявкам.</li>
        </ul>
      </section>

      <section>
        <h3>Парольная политика</h3>
        <ul>
          <li>Пароль должен содержать минимум 6 символов.</li>
          <li>Пароль должен содержать буквы и цифры.</li>
          <li>Рекомендуется использовать сложные пароли для администраторов.</li>
        </ul>
      </section>
    </div>
  );

  const getHelpContent = () => {
    if (!user) return null;
    
    switch (user.role) {
      case 'admin':
        return renderAdminHelp();
      case 'security':
        return renderSecurityHelp();
      case 'foreman':
        return renderForemanHelp();
      default:
        return renderUserHelp();
    }
  };

  if (!user) {
    return <div className="loading">Загрузка...</div>;
  }

  return (
    <div className="app">
      <div className="header">
        <div className="header-content">
          <h1>Справка</h1>
          <div className="header-actions">
            <span className="user-info">{user.fullName}</span>
            <button className="btn btn-secondary" onClick={() => navigate('/dashboard')} style={{ marginRight: '10px' }}>
              Назад
            </button>
            <button className="btn btn-secondary" onClick={logout}>
              Выйти
            </button>
          </div>
        </div>
      </div>

      <div className="container">
        <div className="card">
          {getHelpContent()}
        </div>
      </div>
      <Footer />
    </div>
  );
};

export default Help;











