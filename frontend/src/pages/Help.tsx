import { useAuth } from '../contexts/AuthContext';
import { useNavigate } from 'react-router-dom';
import Footer from '../components/Footer';
import './Help.css';

const Help = () => {
  const { user, logout } = useAuth();
  const navigate = useNavigate();

  const renderUserHelp = () => (
    <div className="help-content">
      <h2>Помощь для пользователя</h2>
      
      <section>
        <h3>Основные возможности</h3>
        <ul>
          <li><strong>Создание заявок на пропуск:</strong> Вы можете создавать заявки на въезд транспортных средств на территорию.</li>
          <li><strong>Просмотр своих заявок:</strong> Вы видите все свои заявки с их статусами.</li>
          <li><strong>Редактирование заявок:</strong> Вы можете редактировать свои заявки до их активации охраной.</li>
          <li><strong>Удаление заявок:</strong> Вы можете удалять свои заявки.</li>
          <li><strong>Редактирование профиля:</strong> Вы можете изменить свой контактный телефон и пароль.</li>
        </ul>
      </section>

      <section>
        <h3>Правила работы с заявками</h3>
        <ul>
          <li>Заявка должна быть создана заранее, до планируемого въезда.</li>
          <li>Укажите корректные данные: тип транспорта, номер, дату въезда, адрес.</li>
          <li>После создания заявка имеет статус "Ожидает".</li>
          <li>Охрана проверяет заявку и может изменить её статус на "Заехал" или "Отклонен".</li>
          <li>После активации заявки охраной, вы не можете её редактировать.</li>
        </ul>
      </section>

      <section>
        <h3>Статусы заявок</h3>
        <ul>
          <li><strong>Ожидает:</strong> Заявка создана и ожидает проверки охраной.</li>
          <li><strong>Заехал:</strong> Транспорт заехал на территорию (активировано охраной).</li>
          <li><strong>Отклонен:</strong> Заявка отклонена охраной.</li>
        </ul>
      </section>

      <section>
        <h3>Безопасность</h3>
        <ul>
          <li>Пароль должен содержать минимум 6 символов, включая буквы и цифры.</li>
          <li>Не передавайте свои учетные данные третьим лицам.</li>
          <li>При утере пароля используйте функцию восстановления пароля.</li>
        </ul>
      </section>
    </div>
  );

  const renderForemanHelp = () => (
    <div className="help-content">
      <h2>Помощь для прораба</h2>
      
      <section>
        <h3>Основные возможности</h3>
        <ul>
          <li><strong>Создание заявок на пропуск:</strong> Вы можете создавать заявки на въезд транспортных средств.</li>
          <li><strong>Просмотр своих заявок:</strong> Вы видите все свои заявки с их статусами.</li>
          <li><strong>Редактирование заявок:</strong> Вы можете редактировать свои заявки до их активации охраной.</li>
          <li><strong>Удаление заявок:</strong> Вы можете удалять свои заявки.</li>
          <li><strong>Редактирование профиля:</strong> Вы можете изменить свой контактный телефон и пароль.</li>
        </ul>
      </section>

      <section>
        <h3>Особенности роли прораба</h3>
        <ul>
          <li>Ваш аккаунт может иметь установленную дату деактивации.</li>
          <li>После наступления даты деактивации вы не сможете войти в систему.</li>
          <li>О дате деактивации вас уведомит администратор.</li>
        </ul>
      </section>

      <section>
        <h3>Правила работы с заявками</h3>
        <ul>
          <li>Заявка должна быть создана заранее, до планируемого въезда.</li>
          <li>Укажите корректные данные: тип транспорта, номер, дату въезда, адрес.</li>
          <li>После создания заявка имеет статус "Ожидает".</li>
          <li>Охрана проверяет заявку и может изменить её статус на "Заехал" или "Отклонен".</li>
          <li>После активации заявки охраной, вы не можете её редактировать.</li>
        </ul>
      </section>

      <section>
        <h3>Статусы заявок</h3>
        <ul>
          <li><strong>Ожидает:</strong> Заявка создана и ожидает проверки охраной.</li>
          <li><strong>Заехал:</strong> Транспорт заехал на территорию (активировано охраной).</li>
          <li><strong>Отклонен:</strong> Заявка отклонена охраной.</li>
        </ul>
      </section>
    </div>
  );

  const renderSecurityHelp = () => (
    <div className="help-content">
      <h2>Помощь для охраны</h2>
      
      <section>
        <h3>Основные возможности</h3>
        <ul>
          <li><strong>Просмотр всех заявок:</strong> Вы видите все заявки на пропуск, созданные пользователями.</li>
          <li><strong>Активация заявок:</strong> Вы можете изменить статус заявки на "Заехал" когда транспорт заехал на территорию.</li>
          <li><strong>Отклонение заявок:</strong> Вы можете отклонить заявку, если она не соответствует требованиям.</li>
          <li><strong>Редактирование заявок:</strong> Вы можете редактировать данные заявки: дату въезда, номер авто, адрес, участок, ФИО пользователя.</li>
          <li><strong>Добавление комментария охраны:</strong> Вы можете добавить комментарий к заявке для внутреннего использования.</li>
        </ul>
      </section>

      <section>
        <h3>Правила работы с заявками</h3>
        <ul>
          <li>Проверяйте заявки перед активацией.</li>
          <li>Убедитесь, что данные в заявке соответствуют реальному транспорту.</li>
          <li>Активируйте заявку только после фактического въезда транспорта.</li>
          <li>При необходимости вы можете отредактировать данные заявки (дату, номер, адрес, участок, ФИО).</li>
          <li>Вы не можете редактировать комментарий пользователя.</li>
        </ul>
      </section>

      <section>
        <h3>Статусы заявок</h3>
        <ul>
          <li><strong>Ожидает:</strong> Заявка создана пользователем и ожидает проверки.</li>
          <li><strong>Заехал:</strong> Транспорт заехал на территорию (установите этот статус при въезде).</li>
          <li><strong>Отклонен:</strong> Заявка отклонена (используйте при необходимости).</li>
        </ul>
      </section>

      <section>
        <h3>Автоматическое обновление</h3>
        <ul>
          <li>Список заявок автоматически обновляется каждые 30 секунд.</li>
          <li>Обновление приостанавливается, когда открыто окно редактирования заявки.</li>
        </ul>
      </section>
    </div>
  );

  const renderAdminHelp = () => (
    <div className="help-content">
      <h2>Помощь для администратора</h2>
      
      <section>
        <h3>Управление пользователями</h3>
        <ul>
          <li><strong>Создание пользователей:</strong> Вы можете создавать новых пользователей с ролями: Пользователь, Прораб, Охрана, Администратор.</li>
          <li><strong>Редактирование пользователей:</strong> Вы можете редактировать данные любого пользователя.</li>
          <li><strong>Смена пароля:</strong> Вы можете изменить пароль любого пользователя.</li>
          <li><strong>Деактивация аккаунтов:</strong> Вы можете деактивировать любой аккаунт или установить дату деактивации для прорабов.</li>
          <li><strong>Фильтрация:</strong> Используйте фильтры для поиска пользователей по email, телефону, ФИО, участку.</li>
        </ul>
      </section>

      <section>
        <h3>Роли пользователей</h3>
        <ul>
          <li><strong>Пользователь:</strong> Может создавать и управлять своими заявками.</li>
          <li><strong>Прораб:</strong> Имеет те же права, что и пользователь, но может иметь дату деактивации аккаунта.</li>
          <li><strong>Охрана:</strong> Может просматривать и активировать заявки, редактировать данные заявок.</li>
          <li><strong>Администратор:</strong> Полный доступ ко всем функциям системы.</li>
        </ul>
      </section>

      <section>
        <h3>Настройки системы</h3>
        <ul>
          <li><strong>Настройка почтового сервера:</strong> В разделе "Настройки" вы можете настроить SMTP для отправки писем с восстановлением пароля.</li>
          <li><strong>Тестирование почты:</strong> Вы можете отправить тестовое письмо для проверки настроек SMTP.</li>
        </ul>
      </section>

      <section>
        <h3>Правила работы</h3>
        <ul>
          <li>Регулярно проверяйте список пользователей на наличие деактивированных аккаунтов.</li>
          <li>Устанавливайте дату деактивации для прорабов при необходимости.</li>
          <li>Следите за безопасностью системы: используйте надежные пароли.</li>
          <li>При создании пользователей указывайте корректные данные.</li>
        </ul>
      </section>

      <section>
        <h3>Парольная политика</h3>
        <ul>
          <li>Пароль должен содержать минимум 6 символов.</li>
          <li>Пароль должен содержать буквы и цифры.</li>
          <li>Рекомендуется использовать сложные пароли для администраторов.</li>
        </ul>
      </section>
    </div>
  );

  const getHelpContent = () => {
    if (!user) return null;
    
    switch (user.role) {
      case 'admin':
        return renderAdminHelp();
      case 'security':
        return renderSecurityHelp();
      case 'foreman':
        return renderForemanHelp();
      default:
        return renderUserHelp();
    }
  };

  if (!user) {
    return <div className="loading">Загрузка...</div>;
  }

  return (
    <div className="app">
      <div className="header">
        <div className="header-content">
          <h1>Справка</h1>
          <div className="header-actions">
            <span className="user-info">{user.fullName}</span>
            <button className="btn btn-secondary" onClick={() => navigate('/dashboard')} style={{ marginRight: '10px' }}>
              Назад
            </button>
            <button className="btn btn-secondary" onClick={logout}>
              Выйти
            </button>
          </div>
        </div>
      </div>

      <div className="container">
        <div className="card">
          {getHelpContent()}
        </div>
      </div>
      <Footer />
    </div>
  );
};

export default Help;

